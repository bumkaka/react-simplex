"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Storage=exports.SimplexMapToProps=exports.SimplexStorage=exports.SimplexConnect=exports.Simplex=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_ref=function(){function e(e,t){return"function"!=typeof t&&(t=function(e){return JSON.parse(JSON.stringify(e))}),function(o){function a(){_classCallCheck(this,a);var e=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return e.state=t(l.Storage,e.props),e}return _inherits(a,o),_createClass(a,[{key:"componentWillReceiveProps",value:function(e){var r=t(l.Storage,e,this.state);_underscore2.default.isEqual(this.state,r)||this.setState(r)}},{key:"componentDidMount",value:function(){var e=this;l.onChange(r+"."+n,function(r){var n=t(l.Storage,e.props,e.state);_underscore2.default.isEqual(e.state,n)||e.setState(n)})}},{key:"componentWillUnmount",value:function(){l.remove(r+"."+n)}},{key:"render",value:function(){return i.createElement(e,_extends({},this.props,this.state))}}]),a}(i.Component)}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(t)?function(r){function o(e){_classCallCheck(this,o);var r=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return r.state=_underscore2.default.pick(l,t),r}return _inherits(o,r),_createClass(o,[{key:"componentDidMount",value:function(){var e=this;t.forEach(function(r){l.onChange(r+"."+n,function(r){var n=_underscore2.default.pick(l,t);_underscore2.default.isEqual(e.state,n)||e.setState(n)})})}},{key:"componentWillUnmount",value:function(){t.forEach(function(e){l.remove(e+"."+n)})}},{key:"render",value:function(){return i.createElement(e,_extends({},this.props,this.state))}}]),o}(i.Component):void console.error("SimplexConnect props must be an array")}var r="any",n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),o=function(){try{return!window}catch(e){return!0}},i=o()?global.React:window.React;void 0===i&&(i=require("react"));var a=null;if(o())try{a=require("react-native").AsyncStorage}catch(e){var s=function(){function e(){_classCallCheck(this,e),this.store={}}return _createClass(e,[{key:"getItem",value:function(e,t){if(!t)return this.store[e];t(this.store[e])}},{key:"setItem",value:function(e,t,r){this.store[e]=t}}]),e}();a=new s}else a=localStorage;var c=function(){function e(){_classCallCheck(this,e),this.listeners=[],this.Storage={},this.sync={}}return _createClass(e,[{key:"init",value:function(e){var t=this,r=arguments,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.Storage[e]=n,this.sync[e]=i,this.hasOwnProperty(e)||Object.defineProperty(this,e,{set:function(r){t.set(e,r)},get:function(e){return t.Storage[r[0]]}}),i)try{var s=null;o()?a.getItem("SIMPLEX_"+e,function(r){s=JSON.parse(r),t.Storage[e]=void 0!==s&&null!==s?s:n}):(s=JSON.parse(a.getItem("SIMPLEX_"+e)),this.Storage[e]=void 0!==s&&null!==s?s:n)}catch(t){console.error("Simplex: can`t sync data from localStorage for "+e)}}},{key:"get",value:function(e){return this.Storage[e]}},{key:"update",value:function(e,t){var r=JSON.parse(JSON.stringify(Object.assign({},this.Storage[e],t)));this.set(e,r)}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.Storage[e]=t,this.sync[e]&&(o()?a.setItem("SIMPLEX_"+e,JSON.stringify(this.Storage[e]),function(){}):a.setItem("SIMPLEX_"+e,JSON.stringify(this.Storage[e]))),this.trigger(e)}},{key:"onChange",value:function(){var e="",t=function(){};switch(arguments.length){case 1:e=r,t=arguments[0];break;case 2:e=arguments[0],t=arguments[1]}this.listeners.push({name:e,callback:t})}},{key:"trigger",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,n=null;return this.listeners.forEach(function(o){o.callback&&(0===o.name.indexOf(r)?n=o.callback.call({},e.Storage):0===o.name.indexOf(t)&&(n=o.callback.call({},_defineProperty({},t,e.Storage[t]))))}),n}},{key:"remove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;for(var t in this.listeners)this.listeners[t].name==e&&delete this.listeners[t];this.listeners=this.listeners.filter(function(e){return e})}}]),e}(),l=new c;return{Simplex:l,SimplexConnect:t,SimplexStorage:c,SimplexMapToProps:e,Storage:a}}(),Simplex=_ref.Simplex,SimplexConnect=_ref.SimplexConnect,SimplexStorage=_ref.SimplexStorage,SimplexMapToProps=_ref.SimplexMapToProps,Storage=_ref.Storage;exports.Simplex=Simplex,exports.SimplexConnect=SimplexConnect,exports.SimplexStorage=SimplexStorage,exports.SimplexMapToProps=SimplexMapToProps,exports.Storage=Storage;